# RPG/CL Development Support Tool for VS Code

## overview

- VS Codeの拡張機能として、AS400のRPG,CLコードを開発するための支援ツールを作成します。
- RPGはILERPGの固定長フォーマットを使用します。フリーフォーマットは対象外です。
- 有効な拡張子は`.rpgle`（RPG）および`.clp`（CL）とします。
- ソースファイルの文字コードはEBCDICで、CCSIDは5026を使用します。
- RPGの4行目はユニコードで扱えない制御文字が含まれる為、修正は7桁目以降に対して行うこと
- Code for IBM iで提供されている機能の実装は対象外です。
- "requirements"セクションに記載の機能を実装します。それ以外の機能は対象外です。

## technologies

- TypeScript
- Node.js
- HTML
- SCSS
- JSON

## requirements

1. シフトアウト・シフトイン文字の可視化機能
    - VSCodeではDBCSの前後あるシフトアウト・シフトイン文字が表示されず桁がずれて表示される為、シフトアウトを`{`、シフトインを`}`として表示する機能を実装すること
    - 表示のみで、実際のファイル内容は変更しないこと

2. Tabキーによるカーソル移動機能
    - 固定長フォーマットの為、Tabでインデントするのではなく、キーワードの位置にカーソルを移動させる機能を実装すること
    - 後方にスペースがなくカーソル移動ができない場合は、スペースを自動挿入すること

3. Ctrl+/キーによるコメントアウト・コメント解除機能
    - 選択行またはカーソル行をコメントアウト・コメント解除する機能を実装すること
    - RPGは6桁目に`*`を挿入・削除し、CLは1桁目に`/*`、80桁目に`*/`を挿入・削除すること

4. F4キーによるプロンプター表示機能
    - SEUでのF4キー操作同様、プロンプター表示機能を実装すること
    - プロンプターはRPGは仕様書単位、CLはコマンド単位でプロンプターを表示すること
    - プロンプターのすべての仕様はJSONで定義ができるようにし、容易に追加・修正できるようにすること
    - プロンプターはHTMLで実装し、VSCodeのWebView APIを使用して表示すること
    - 既存のコードに対してF4キーを押下した場合、該当箇所の内容をプロンプターに反映すること
    - プロンプターを閉じた場合、元のカーソル位置に戻ること
    - 詳細は以下の"details of f4 key prompter"セクションを参照すること
    - CLコマンドは`+`で改行された複数行のコマンドに対応できること

## details of f4 key prompter

### user interface requirements

- プロンプターはEscapeキーで閉じることができること
- プロンプターの入力エリアは、Tabキーで次の入力エリアに移動できること
- プロンプターの入力エリアは、Enterキーで確定できること
- 必須入力項目は、入力エリアのラベルに`*`を表示すること
- `CALL`コマンドの`PARM`など、複数の値を入力できる場合は、入力エリアを追加・削除できること
- `CALL`コマンドの`PGM`内の`LIBL`と`PGM`のように、1つのパラメータに複数の値を指定できる場合は、グループ化して表示できること
- グループ化されたパラメータも複数の値を追加・削除できること
- 入力エリアにプレースホルダーを表示できること
- 入力できる内容が限定される場合は、ドロップダウンリストで選択できること
- プロンプターのデザインは、VSCodeのテーマに合わせて変更されること
- ヘルプ表示は、ポップアップウィンドウで表示し、F1キーまたはEscapeキーで閉じることができること
- ヘルプ表示が可能なキーワードには、ヘルプアイコンを表示すること
- プロンプター内の入力エリアでF1キーを押下した場合、該当キーワードのヘルプを表示すること
- 入力エリアの属性に応じて以下のバリデーションを実装し、エラーメッセージをツールチップで表示すること
    - 文字数制限
    - 数値のみ
    - 特定の文字セットのみ
    - 必須入力
- 初期状態では非表示のパラメータの表示・非表示を切り替えられること
- 非表示のパラメータでも、入力がされている場合は、非表示にできないこと

### json definition requirements

- RPGの仕様書、CLのコマンドは、それぞれ別のJSONファイルで定義すること
- グループ化されたパラメータは、ネスト構造で定義すること
- JSONファイルはUTF-8で保存すること
- JSONファイルの構造は、以下の要素を含むこと
    - キーワード名
    - キーワードの説明（ヘルプ表示用）
    - パラメータ一覧
        - パラメータ名
        - パラメータの説明（ヘルプ表示用）
        - 入力エリアのタイプ（テキスト、ドロップダウンなど）
        - 必須入力フラグ
        - 表示・非表示フラグ（初期状態）
        - デフォルト値
        - 属性
        - 桁数
        - プレースホルダー
        - 最大パラメータ数（複数値を指定できる場合。2以上の場合は複数値を指定可能とする）
        - ドロップダウンリストの選択肢（該当する場合）
        - ネストされたパラメータ（グループ化されたパラメータの場合）
