# ILE RPG 固定長フォーマット 仕様書リファレンス

## 目次

1. [概要](#概要)
2. [ソースレコード構成](#ソースレコード構成)
3. [H仕様書（制御仕様書）](#h仕様書制御仕様書)
4. [F仕様書（ファイル仕様書）](#f仕様書ファイル仕様書)
5. [D仕様書（定義仕様書）](#d仕様書定義仕様書)
6. [I仕様書（入力仕様書）](#i仕様書入力仕様書)
7. [C仕様書（演算仕様書）](#c仕様書演算仕様書)
8. [O仕様書（出力仕様書）](#o仕様書出力仕様書)
9. [P仕様書（プロシージャー仕様書）](#p仕様書プロシージャー仕様書)
10. [データタイプ詳細](#データタイプ詳細)
11. [参考資料](#参考資料)

---

## 概要

### ILE RPG とは

- **ILE** = Integrated Language Environment（統合言語環境）
- **RPG** = Report Program Generator
- IBM i（旧AS/400）の主力プログラミング言語
- 固定長フォーマットとフリーフォーマットの両方をサポート

### ソースレコード仕様

- **固定形式**: 1行80バイト（RPG IV）
- **拡張形式**: 1行100バイト
- **フィールド名**: 最大14文字（従来は6文字）

---

## ソースレコード構成

### 基本構造

```
桁位置    内容
1-5       シーケンス番号（オプション）
6         仕様書コード（H, F, D, I, C, O, P）
7-80      仕様書本体（仕様書タイプにより異なる）
```

### 仕様書タイプ一覧

| コード | 仕様書名 | 用途 |
|--------|----------|------|
| **H** | 制御仕様書 | プログラム全体の制御情報 |
| **F** | ファイル仕様書 | 使用するファイルの定義 |
| **D** | 定義仕様書 | データ項目、変数の定義 |
| **I** | 入力仕様書 | 入力レコード・フィールドの定義 |
| **C** | 演算仕様書 | プログラムロジック（処理手順） |
| **O** | 出力仕様書 | 出力レコード・フィールドの定義 |
| **P** | プロシージャー仕様書 | サブプロシージャーの定義 |

---

## H仕様書（制御仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**H** |
| 7-80 | キーワード記述エリア |

### 主要キーワード

#### DATEDIT（日付編集形式）

```rpg
H DATEDIT(*YMD/)
```

**選択肢:**
- `*YMD` - 年月日形式
- `*MDY` - 月日年形式
- `*DMY` - 日月年形式
- `*JUL` - ユリウス日形式

**区切り記号:**
- `/` - スラッシュ
- `-` - ハイフン
- `.` - ピリオド
- `,` - コンマ
- ` ` - 空白

#### DATFMT（日付形式）

```rpg
H DATFMT(*ISO)
```

**選択肢:**
- `*ISO` - YYYY-MM-DD
- `*USA` - MM/DD/YYYY
- `*EUR` - DD.MM.YYYY
- `*JIS` - YYYY-MM-DD
- `*YMD` - YY/MM/DD
- `*MDY` - MM/DD/YY
- `*DMY` - DD/MM/YY
- `*JUL` - YY/DDD

#### DFTACTGRP（デフォルト活動化グループ）

```rpg
H DFTACTGRP(*NO)
```

**選択肢:**
- `*YES` - デフォルト活動化グループを使用
- `*NO` - 新規活動化グループを作成

#### ACTGRP（活動化グループ）

```rpg
H ACTGRP(*NEW)
H ACTGRP('MYGROUP')
```

**選択肢:**
- `*NEW` - 新規活動化グループ
- `*CALLER` - 呼び出し側と同じグループ
- `*STGMDL` - ストレージ・モデル
- `'グループ名'` - 名前付きグループ

#### OPTIMIZE（最適化レベル）

```rpg
H OPTIMIZE(*FULL)
```

**選択肢:**
- `*NONE` - 最適化なし（デバッグ用）
- `*BASIC` - 基本最適化
- `*FULL` - 完全最適化（本番用）

#### その他の主要キーワード

```rpg
H OPTION(*NODEBUGIO)
H BNDDIR('MYLIB/MYBNDDIR')
H COPYRIGHT('(C) 2024 Company Name')
H DEBUG(*YES)
H DECEDIT('0,')
H TRUNCNBR(*YES)
H FIXNBR(*ZONED *INPUTPACKED)
```

---

## F仕様書（ファイル仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**F** |
| 7-16 | ファイル名（最大10文字） |
| 17 | ファイル・タイプ |
| 18 | ファイル指定 |
| 19 | ファイル形式 |
| 20-23 | レコード長 |
| 24-27 | 制限処理 |
| 28 | レコード・アドレス・タイプ |
| 29-33 | ファイル編成 |
| 34-42 | 装置 |
| 44-80 | キーワード |

### 17桁目：ファイル・タイプ

| コード | 意味 | 説明 |
|--------|------|------|
| **I** | Input | 入力専用 |
| **O** | Output | 出力専用 |
| **U** | Update | 更新（入出力） |
| **C** | Combined | 複合（入出力） |

### 18桁目：ファイル指定

| コード | 意味 | 説明 |
|--------|------|------|
| **F** | Full procedural | 全手順ファイル |
| **(空白)** | Demand | 要求時ファイル |

### 19桁目：ファイル形式

| コード | 意味 | 説明 |
|--------|------|------|
| **E** | Externally described | 外部記述ファイル |
| **F** | Program described | プログラム記述ファイル |

### 34-42桁目：装置タイプ

| 装置名 | 説明 |
|--------|------|
| **DISK** | データベースファイル |
| **PRINTER** | 印刷装置ファイル |
| **WORKSTN** | ワークステーション（画面）ファイル |
| **SPECIAL** | 特殊装置ファイル |
| **SEQ** | 順次ファイル |

### 44-80桁目：主要キーワード

#### USROPN（ユーザーオープン）

```rpg
FCUSTMST   IF   E           K DISK    USROPN
```

ファイルを明示的にOPEN命令でオープンする必要がある。

#### RENAME（レコード形式名変更）

```rpg
FSLSMST    IF   E           K DISK    RENAME(SLSREC:SLSDATA)
```

#### KEYED（キー付きファイル）

```rpg
FEMPFILE   UF A E           K DISK
```

29-33桁目に`K`を指定することで、キー付きアクセスを指定。

#### SFILE（サブファイル）

```rpg
FDSPFILE   CF   E             WORKSTN SFILE(SUBSFL:RRN)
```

#### INFDS（ファイル情報データ構造）

```rpg
FLOGFILE   O    E             DISK    INFDS(FILEINFO)
```

#### COMMIT（コミットメント制御）

```rpg
FTRANFILE  UF   E           K DISK    COMMIT
```

### F仕様書の記述例

```rpg
F*=====================================================================
F* ファイル定義
F*=====================================================================
F* マスタファイル
FCUSTMST   IF   E           K DISK    USROPN
F                                     RENAME(CUSTREC:CUSTOMER)
F* トランザクションファイル
FSLSMST    UF A E           K DISK    COMMIT
F                                     INFDS(SLSINFO)
F* 画面ファイル
FDSPFILE   CF   E             WORKSTN SFILE(DTLSFL:RRN)
F                                     INFDS(WSINFO)
F* 印刷ファイル
FRPTFILE   O    E             PRINTER OFLIND(*INOF)
```

---

## D仕様書（定義仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**D** |
| 7-21 | 名前（最大14文字） |
| 22 | 外部記述（E） |
| 23 | データ構造タイプ |
| 24-25 | 定義タイプ |
| 26-32 | From位置 |
| 33-39 | To位置/長さ |
| 40 | データ・タイプ |
| 41-42 | 小数点位置 |
| 44-80 | キーワード |

### 24-25桁目：定義タイプ

| コード | 意味 | 説明 |
|--------|------|------|
| **DS** | Data Structure | データ構造 |
| **S** | Standalone | スタンドアロン変数 |
| **C** | Constant | 定数 |
| **PR** | Prototype | プロトタイプ |
| **PI** | Procedure Interface | プロシージャー・インターフェース |

### 40桁目：データ・タイプ

#### 文字データ・タイプ

| コード | データ・タイプ | 説明 | 長さ |
|--------|----------------|------|------|
| **A** | Character | 文字形式 | 1-65535バイト |
| **N** | Indicator | 標識形式（論理値） | 1バイト固定 |
| **G** | Graphic | グラフィック形式（DBCS） | 1-16383文字 |
| **C** | UCS-2 | UCS-2形式（Unicode） | 1-16383文字 |

#### 数値データ・タイプ

| コード | データ・タイプ | 説明 | 長さ指定 |
|--------|----------------|------|----------|
| **P** | Packed Decimal | パック10進数 | 1-31桁 |
| **S** | Zoned Decimal | ゾーン10進数 | 1-31桁 |
| **B** | Binary | 2進数 | 2/4/8バイト |
| **I** | Integer | 符号付き整数 | 3/5/10/20 |
| **U** | Unsigned | 符号なし整数 | 3/5/10/20 |
| **F** | Float | 浮動小数点 | 4/8 |

#### 日付/時刻データ・タイプ

| コード | データ・タイプ | 説明 | 形式 |
|--------|----------------|------|------|
| **D** | Date | 日付 | DATFMT指定 |
| **T** | Time | 時刻 | TIMFMT指定 |
| **Z** | Timestamp | タイム・スタンプ | 固定形式 |

#### ポインター/オブジェクト

| コード | データ・タイプ | 説明 | 長さ |
|--------|----------------|------|------|
| **\*** | Pointer | 基底ポインター | 16バイト固定 |
| **\*PROC** | Procedure Pointer | プロシージャー・ポインター | 16バイト固定 |
| **O** | Object | オブジェクト | - |

### 数値形式の詳細

#### 整数形式（I）

```rpg
D COUNT           S              5I 0
D BIGNUM          S             10I 0
D HUGENUM         S             20I 0
```

| 指定 | バイト数 | 範囲 |
|------|----------|------|
| 3I 0 | 1 | -128 ～ 127 |
| 5I 0 | 2 | -32,768 ～ 32,767 |
| 10I 0 | 4 | -2,147,483,648 ～ 2,147,483,647 |
| 20I 0 | 8 | -9,223,372,036,854,775,808 ～ 9,223,372,036,854,775,807 |

#### 符号なし整数（U）

```rpg
D UCNT            S              5U 0
D UBIG            S             10U 0
```

| 指定 | バイト数 | 範囲 |
|------|----------|------|
| 3U 0 | 1 | 0 ～ 255 |
| 5U 0 | 2 | 0 ～ 65,535 |
| 10U 0 | 4 | 0 ～ 4,294,967,295 |
| 20U 0 | 8 | 0 ～ 18,446,744,073,709,551,615 |

#### パック10進数（P）

```rpg
D PRICE           S              9P 2
D AMOUNT          S             11P 0
```

桁数の長さ（バイト） = (桁数 ÷ 2) + 1

例：9P 2 = 5バイト

### 44-80桁目：主要キーワード

#### INZ（初期化）

```rpg
D COUNTER         S              5I 0 INZ(0)
D NAME            S             30A   INZ('Unknown')
D TODAY           S               D   INZ(*SYS)
D FLAG            S              1A   INZ(*ON)
```

#### DIM（配列次元）

```rpg
D ARRAY           S              5P 0 DIM(100)
D NAMES           S             30A   DIM(50)
```

#### OVERLAY（オーバーレイ）

```rpg
D DATE8           DS
D  YEAR                   1      4  0
D  MONTH                  5      6  0
D  DAY                    7      8  0
```

または

```rpg
D FULLDATE        S              8A
D YEAR            S              4A   OVERLAY(FULLDATE:1)
D MONTH           S              2A   OVERLAY(FULLDATE:5)
```

#### VARYING（可変長）

```rpg
D MESSAGE         S            100A   VARYING
D VARGRAPH        S             50G   VARYING
```

#### DTAARA（データ域）

```rpg
D SYSPARM         S             50A   DTAARA(*LDA)
D LASTRUN         S               D   DTAARA('LASTRUN')
```

#### LIKEDS（データ構造参照）

```rpg
D CUSTOMER        DS                  QUALIFIED
D  CUSTNO                        6S 0
D  NAME                         40A
D  ADDR                         60A

D TEMPCUST        DS                  LIKEDS(CUSTOMER)
```

#### LIKE（フィールド参照）

```rpg
D EMPNO           S              6S 0
D NEWEMPNO        S                   LIKE(EMPNO)
```

### D仕様書の記述例

#### スタンドアロン変数

```rpg
D*=====================================================================
D* スタンドアロン変数定義
D*=====================================================================
D WDATE           S              8S 0
D WTIME           S              6S 0
D WUSER           S             10A
D ERRFLG          S              1A
D COUNTER         S              5I 0 INZ(0)
D TOTAMT          S             11P 2 INZ(0)
D TODAY           S               D   DATFMT(*ISO)
```

#### データ構造

```rpg
D*=====================================================================
D* データ構造定義
D*=====================================================================
D DATETIME        DS
D  SDATE                  8S 0
D  SYY                    4S 0 OVERLAY(SDATE:1)
D  SMM                    2S 0 OVERLAY(SDATE:5)
D  SDD                    2S 0 OVERLAY(SDATE:7)
```

#### 修飾データ構造

```rpg
D CUSTOMER        DS                  QUALIFIED
D  CUSTNO                        6S 0
D  NAME                         40A
D  ADDR                         60A
D  PHONE                        15A
```

使用時：`CUSTOMER.CUSTNO`, `CUSTOMER.NAME`

#### プロトタイプ

```rpg
D*=====================================================================
D* プロトタイプ定義
D*=====================================================================
D GetCustomer     PR                  EXTPGM('GETCUST')
D  CustNo                        6S 0
D  CustName                     40A
D  ErrorCode                     7A
```

---

## I仕様書（入力仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**I** |
| 7-16 | ファイル名/データ構造名 |
| 17-18 | 論理関係/標識 |
| 19-20 | レコード識別標識 |
| 21-41 | レコード識別コード |
| 43-46 | フィールド位置（From） |
| 47-51 | フィールド位置（To） |
| 52 | データ・タイプ |
| 53-58 | 小数点位置/日付形式 |
| 59-68 | フィールド名 |
| 69-74 | 制御レベル |

### I仕様書の記述例

```rpg
I*=====================================================================
I* 入力レコード定義
I*=====================================================================
IINPUTFILE NS
I                                1   8 0RECTYPE
I                                9  14 0CUSTNO
I                               15  54  CUSTNAME
I                               55  94  ADDRESS
```

**注意：** 現在はE仕様書（外部記述）の使用が一般的であり、I仕様書の使用は減少しています。

---

## C仕様書（演算仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**C** |
| 7-8 | 制御レベル標識 |
| 9-11 | 条件標識 |
| 12-25 | 演算項目1 |
| 26-35 | 演算コード |
| 36-49 | 演算項目2 |
| 50-63 | 結果フィールド |
| 64-68 | フィールド長 |
| 69-70 | 小数点位置 |
| 71-76 | 結果標識 |
| 80 | コメント標識 |

### 7-8桁目：制御レベル標識

| 標識 | 意味 |
|------|------|
| L1-L9 | 制御レベル標識 |
| LR | 最終レコード標識 |

### 9-11桁目：条件標識

```rpg
C     *IN01         IFEQ      *ON
C                   EXSR      PROCESS
C                   ENDIF
```

または

```rpg
C  N01              EXSR      PROCESS
C   01              EXSR      SKIP
```

| 記号 | 意味 |
|------|------|
| (空白) | 標識がONの場合 |
| N | 標識がOFFの場合（NOT） |

### 26-35桁目：主要演算コード

#### ファイル操作

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **CHAIN** | キーでレコード読込 | `CHAIN KEY RECORD 90` |
| **READ** | 次レコード読込 | `READ FILE 90` |
| **READE** | 同一キー読込 | `READE KEY RECORD 90` |
| **READP** | 前レコード読込 | `READP FILE 90` |
| **READPE** | 同一キー前読込 | `READPE KEY RECORD 90` |
| **WRITE** | レコード書込 | `WRITE RECORD` |
| **UPDATE** | レコード更新 | `UPDATE RECORD` |
| **DELETE** | レコード削除 | `DELETE RECORD` |
| **SETLL** | 位置付け（下限） | `SETLL KEY RECORD 90` |
| **SETGT** | 位置付け（上限） | `SETGT KEY RECORD` |
| **OPEN** | ファイルオープン | `OPEN FILE` |
| **CLOSE** | ファイルクローズ | `CLOSE FILE` |

#### 制御構造

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **IF / ELSE / ENDIF** | 条件分岐 | `IF X > 0` |
| **DOW / ENDDO** | 前判定繰返し | `DOW *IN03 = *OFF` |
| **DOU / ENDDO** | 後判定繰返し | `DOU EOF = *ON` |
| **FOR / ENDFOR** | カウント繰返し | `FOR I = 1 TO 10` |
| **SELECT / WHEN / OTHER / ENDSL** | 複数分岐 | `SELECT` |

#### サブルーチン・プログラム呼出

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **EXSR** | サブルーチン実行 | `EXSR CALC` |
| **BEGSR / ENDSR** | サブルーチン定義 | `BEGSR CALC` |
| **CALLP** | プロシージャー呼出 | `CALLP PROC(PARM)` |
| **CALLB** | バインド呼出 | `CALLB 'PROC'` |
| **RETURN** | 戻る | `RETURN` |

#### 数値演算

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **EVAL** | 式評価 | `EVAL TOTAL = AMT1 + AMT2` |
| **ADD** | 加算 | `ADD 1 COUNTER` |
| **SUB** | 減算 | `SUB AMT TOTAL` |
| **MULT** | 乗算 | `MULT QTY PRICE AMOUNT` |
| **DIV** | 除算 | `DIV 2 AVERAGE` |
| **MVR** | 剰余取得 | `MVR REMAIN` |
| **Z-ADD** | ゼロ加算（代入） | `Z-ADD 100 TOTAL` |
| **Z-SUB** | ゼロ減算 | `Z-SUB AMT RESULT` |

#### 文字列操作

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **MOVE** | 右詰め転送 | `MOVE NAME TEMP` |
| **MOVEL** | 左詰め転送 | `MOVEL NAME TEMP` |
| **CAT** | 文字列連結 | `CAT STR1 STR2 RESULT` |
| **SUBST** | 部分文字列抽出 | `SUBST STR:1:5 RESULT` |
| **SCAN** | 文字列検索 | `SCAN 'ABC' STR POS` |

#### その他

| 演算コード | 機能 | 例 |
|-----------|------|-----|
| **CLEAR** | クリア | `CLEAR FIELD` |
| **RESET** | 初期化 | `RESET *ALL` |
| **TIME** | 時刻取得 | `TIME DATETIME` |
| **DSPLY** | メッセージ表示 | `DSPLY MSG` |
| **SETON / SETOFF** | 標識設定 | `SETON 10` |

### 71-76桁目：結果標識

| 桁位置 | 標識の意味 |
|--------|------------|
| 71-72 | 高位（HI）標識 |
| 73-74 | 低位（LO）標識 |
| 75-76 | 等位（EQ）標識 / エラー標識 |

### C仕様書の記述例

#### 従来形式

```rpg
C*=====================================================================
C* メイン処理
C*=====================================================================
C                   EXSR      INIT
C*
C                   DOW       *IN03 = *OFF
C                   EXFMT     SCREEN
C                   IF        *IN03 = *ON
C                   LEAVE
C                   ENDIF
C                   EXSR      PROCESS
C                   ENDDO
C*
C                   EVAL      *INLR = *ON
C                   RETURN
C*
C*=====================================================================
C* サブルーチン: 初期処理
C*=====================================================================
C     INIT          BEGSR
C*
C                   TIME                    WDATE
C                   TIME                    WTIME
C                   OPEN      CUSTMST
C*
C                   ENDSR
```

#### EVAL使用形式

```rpg
C*=====================================================================
C* 計算処理
C*=====================================================================
C                   EVAL      TOTAL = 0
C                   EVAL      TAX = AMOUNT * 0.10
C                   EVAL      TOTAL = AMOUNT + TAX
C*
C                   IF        TOTAL > 10000
C                   EVAL      DISCOUNT = TOTAL * 0.05
C                   EVAL      TOTAL = TOTAL - DISCOUNT
C                   ENDIF
```

#### ファイル操作例

```rpg
C*=====================================================================
C* レコード読込処理
C*=====================================================================
C     CUSTNO        CHAIN     CUSTREC                        90
C*
C                   IF        NOT *IN90
C                   EVAL      WCUSTNM = CUSTNM
C                   EVAL      WADDR = ADDR
C                   ELSE
C                   EVAL      ERRMSG = '得意先が見つかりません'
C                   ENDIF
```

#### 繰返し処理例

```rpg
C*=====================================================================
C* 配列処理
C*=====================================================================
C                   FOR       I = 1 TO 100
C                   EVAL      ARRAY(I) = I * 10
C                   ENDFOR
C*
C                   DO        10            CNT           3 0
C                   EVAL      TOTAL = TOTAL + ARRAY(CNT)
C                   ENDDO
```

---

## O仕様書（出力仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**O** |
| 7-16 | ファイル名 |
| 17 | タイプ（D/H/T/E） |
| 18-20 | 条件標識 |
| 21-29 | 出力条件 |
| 30-39 | EXCEPT名 |
| 40-51 | スペース・スキップ |

### 17桁目：出力タイプ

| コード | 意味 | 説明 |
|--------|------|------|
| **H** | Heading | 見出し行 |
| **D** | Detail | 明細行 |
| **T** | Total | 合計行 |
| **E** | Exception | 例外出力 |

### O仕様書の記述例

```rpg
O*=====================================================================
O* 出力レコード定義
O*=====================================================================
ORPTFILE   E            HEADER
O                       UDATE         Y     10
O                                           40 'SALES REPORT'
O*
ORPTFILE   D            DETAIL
O                       SLSNO               10
O                       CUSTNAME            50
O                       AMOUNT        1     65
```

**注意：** 現在はE仕様書（外部記述）の使用が一般的であり、O仕様書の使用は減少しています。

---

## P仕様書（プロシージャー仕様書）

### 桁位置

| 桁位置 | 内容 |
|--------|------|
| 6 | 仕様書コード：**P** |
| 7-21 | プロシージャー名 |
| 24 | 始め/終わり（B/E） |
| 44-80 | キーワード |

### 24桁目：始め/終わり

| コード | 意味 |
|--------|------|
| **B** | Begin（プロシージャーの始め） |
| **E** | End（プロシージャーの終わり） |

### 44-80桁目：主要キーワード

| キーワード | 説明 |
|-----------|------|
| **EXPORT** | プロシージャーをエクスポート |
| **EXTPROC('名前')** | 外部プロシージャー名指定 |

### P仕様書の記述例

```rpg
P*=====================================================================
P* プロシージャー定義
P*=====================================================================
P GetTax          B                   EXPORT
D GetTax          PI             9P 2
D  Amount                        9P 2
D  Rate                          3P 2

D Tax             S              9P 2

C                   EVAL      Tax = Amount * Rate
C                   RETURN    Tax
P GetTax          E
```

---

## データタイプ詳細

### 文字データ・タイプ

#### A - 文字形式（Character）

```rpg
D NAME            S             30A
D ADDRESS         S            100A   VARYING
D CODE            S              6A   INZ('ABC123')
```

- **長さ**: 1～65,535バイト
- **用途**: 一般的な文字列データ
- **VARYING**: 可変長文字列として定義可能

#### N - 標識形式（Indicator）

```rpg
D ERRFLAG         S              1A
D ISVALID         S              1N
```

- **長さ**: 1バイト固定
- **値**: '0'（オフ）または'1'（オン）
- **用途**: 論理フラグ、条件判定

#### G - グラフィック形式（Graphic/DBCS）

```rpg
D JNAME           S             20G
D JADDR           S             50G   VARYING
```

- **長さ**: 1～16,383文字（文字数で指定）
- **用途**: 日本語などの2バイト文字
- **注意**: 1文字 = 2バイト

#### C - UCS-2形式（Unicode）

```rpg
D UNAME           S             30C
```

- **長さ**: 1～16,383文字
- **用途**: Unicode文字列
- **注意**: 各文字2バイト

### 数値データ・タイプ

#### P - パック10進数（Packed Decimal）

```rpg
D AMOUNT          S              9P 2
D PRICE           S             11P 0
D RATE            S              3P 2
```

- **桁数**: 1～31桁
- **格納形式**: 2桁で1バイト（最終バイトは1桁+符号）
- **バイト数**: (桁数 ÷ 2) + 1
- **用途**: 最も一般的な数値形式、金額計算など
- **例**: 9P 2 = 5バイト、-9,999,999.99 ～ 9,999,999.99

#### S - ゾーン10進数（Zoned Decimal）

```rpg
D QUANTITY        S              5S 0
D DISCOUNT        S              3S 2
```

- **桁数**: 1～31桁
- **格納形式**: 1桁で1バイト
- **バイト数**: 桁数と同じ
- **用途**: 外部ファイルとの互換性
- **例**: 5S 0 = 5バイト、-99,999 ～ 99,999

#### B - 2進数（Binary）

```rpg
D BINVAL          S              9B 0
```

- **桁数指定**: 1～4桁、5～9桁、10～18桁
- **実際のバイト数**: 2バイト、4バイト、8バイト
- **用途**: 従来の2進数データとの互換性

#### I - 整数形式（Integer）

```rpg
D COUNTER         S              5I 0
D BIGNUM          S             10I 0
D LARGENUM        S             20I 0
```

| 桁指定 | バイト数 | 範囲 |
|--------|----------|------|
| 3I 0 | 1 | -128 ～ 127 |
| 5I 0 | 2 | -32,768 ～ 32,767 |
| 10I 0 | 4 | -2,147,483,648 ～ 2,147,483,647 |
| 20I 0 | 8 | -9,223,372,036,854,775,808 ～ 9,223,372,036,854,775,807 |

- **用途**: カウンタ、添字、高速演算

#### U - 符号なし整数（Unsigned Integer）

```rpg
D UCOUNTER        S              5U 0
D UBIGNUM         S             10U 0
```

| 桁指定 | バイト数 | 範囲 |
|--------|----------|------|
| 3U 0 | 1 | 0 ～ 255 |
| 5U 0 | 2 | 0 ～ 65,535 |
| 10U 0 | 4 | 0 ～ 4,294,967,295 |
| 20U 0 | 8 | 0 ～ 18,446,744,073,709,551,615 |

- **用途**: 常に正の値、バイナリデータ処理

#### F - 浮動小数点（Float）

```rpg
D FPRICE          S              4F
D DVALUE          S              8F
```

| 桁指定 | バイト数 | 精度 |
|--------|----------|------|
| 4F | 4 | 単精度（約7桁） |
| 8F | 8 | 倍精度（約15桁） |

- **用途**: 科学技術計算、広範囲の数値

### 日付/時刻データ・タイプ

#### D - 日付（Date）

```rpg
D TODAY           S               D   DATFMT(*ISO)
D BIRTHDATE       S               D   DATFMT(*USA)
D HIREDATE        S               D   INZ(*SYS)
```

**日付形式（DATFMT）:**

| 形式 | フォーマット | 例 |
|------|--------------|-----|
| *ISO | YYYY-MM-DD | 2024-01-15 |
| *USA | MM/DD/YYYY | 01/15/2024 |
| *EUR | DD.MM.YYYY | 15.01.2024 |
| *JIS | YYYY-MM-DD | 2024-01-15 |
| *YMD | YY/MM/DD | 24/01/15 |
| *MDY | MM/DD/YY | 01/15/24 |
| *DMY | DD/MM/YY | 15/01/24 |
| *JUL | YY/DDD | 24/015 |

**初期化値:**
- `*SYS` - システム日付
- `*JOB` - ジョブ日付
- `D'2024-01-15'` - リテラル

#### T - 時刻（Time）

```rpg
D CURRENT         S               T   TIMFMT(*ISO)
D STARTTIME       S               T   TIMFMT(*HMS)
D NOWTIME         S               T   INZ(*SYS)
```

**時刻形式（TIMFMT）:**

| 形式 | フォーマット | 例 |
|------|--------------|-----|
| *ISO | HH.MM.SS | 14.30.00 |
| *USA | HH:MM AM/PM | 02:30 PM |
| *EUR | HH.MM.SS | 14.30.00 |
| *JIS | HH:MM:SS | 14:30:00 |
| *HMS | HH:MM:SS | 14:30:00 |

**初期化値:**
- `*SYS` - システム時刻
- `T'14:30:00'` - リテラル

#### Z - タイム・スタンプ（Timestamp）

```rpg
D TSTAMP          S               Z
D CREATED         S               Z   INZ(*SYS)
```

**形式:** YYYY-MM-DD-HH.MM.SS.mmmmmm（固定形式）
- **例**: 2024-01-15-14.30.00.123456
- **精度**: マイクロ秒まで

**初期化値:**
- `*SYS` - システムのタイム・スタンプ
- `Z'2024-01-15-14.30.00.000000'` - リテラル

### ポインター/オブジェクト

#### * - 基底ポインター（Pointer）

```rpg
D PTR             S               *
D BASEPTR         S               *   INZ(*NULL)
```

- **長さ**: 16バイト固定
- **用途**: メモリアドレスの保持、BASED変数
- **初期化**: `*NULL`

#### *PROC - プロシージャー・ポインター

```rpg
D PROCPTR         S               *   PROCPTR
D FUNCPTR         S               *   PROCPTR INZ(*NULL)
```

- **長さ**: 16バイト固定
- **用途**: プロシージャーのアドレス保持、動的呼出

#### O - オブジェクト（Object）

```rpg
D JAVAOBJ         S               O   CLASS(*JAVA:'java.lang.String')
```

- **用途**: Javaオブジェクト参照

### データタイプ選択のガイドライン

#### 文字データの選択

| 用途 | 推奨タイプ | 理由 |
|------|------------|------|
| 英数字データ | A | 汎用性が高い |
| 日本語データ | G | DBCS対応 |
| 可変長テキスト | A VARYING | メモリ効率的 |
| フラグ・スイッチ | N | 明示的な論理値 |

#### 数値データの選択

| 用途 | 推奨タイプ | 理由 |
|------|------------|------|
| 金額計算 | P | 精度が高い |
| カウンタ・添字 | I | 高速 |
| 外部ファイル連携 | S | 互換性 |
| ファイルサイズ | U | 符号不要 |
| 科学技術計算 | F | 広範囲 |

---

## 参考資料

### IBM公式マニュアル

#### 主要ドキュメント

1. **ILE RPG 解説書**
   - ファイル名: sc092508.pdf
   - URL: https://www.ibm.com/docs/ja/ssw_ibm_i_75/pdf/sc092508.pdf
   - 内容: RPG IV言語の完全リファレンス

2. **ILE RPG プログラマーの手引き**
   - ファイル名: sc092507.pdf
   - URL: https://www.ibm.com/docs/ja/ssw_ibm_i_75/pdf/sc092507.pdf
   - 内容: プログラミングガイド、ベストプラクティス

3. **IBM i オンラインドキュメント**
   - URL: https://www.ibm.com/docs/ja/i/7.4.0?topic=rpg-ile-reference
   - 内容: 最新のオンラインリファレンス

### バージョン情報

| バージョン | リリース年 | 主な機能追加 |
|-----------|-----------|------------|
| IBM i 7.5 | 2022 | 完全フリーフォーム強化 |
| IBM i 7.4 | 2019 | フリーフォームD仕様書 |
| IBM i 7.3 | 2016 | データ構造検索・ソート |
| IBM i 7.2 | 2014 | 完全フリーフォームH/F/D/P仕様書 |
| IBM i 7.1 | 2010 | Open Access |
| i 6.1 | 2008 | C仕様書フリーフォーム強化 |
| i 5.4 | 2006 | データ構造配列 |

### 学習リソース

#### 推奨学習パス

1. **基礎学習**
   - H, F, D, C仕様書の理解
   - 基本的なデータタイプとファイル操作
   - サブルーチンの使い方

2. **中級学習**
   - データ構造とプロトタイプ
   - エラー処理
   - サブプロシージャー

3. **上級学習**
   - ILE概念（バインディング、活動化グループ）
   - サービスプログラム
   - フリーフォームへの移行

#### コーディング規約の推奨事項

```rpg
H*=====================================================================
H* プログラム名: XXXXXXXX
H* 機能概要    : 
H* 作成日      : YYYY/MM/DD
H* 作成者      : 
H*=====================================================================
H DATEDIT(*YMD/) DATFMT(*ISO)
H OPTION(*NODEBUGIO)
H DFTACTGRP(*NO) ACTGRP(*NEW)

F*=====================================================================
F* ファイル定義
F*=====================================================================

D*=====================================================================
D* データ構造・変数定義
D*=====================================================================

C*=====================================================================
C* メイン処理
C*=====================================================================

C*=====================================================================
C* サブルーチン: 
C*=====================================================================
```

### 注意事項

#### 固定形式 vs フリーフォーム

| 項目 | 固定形式 | フリーフォーム |
|------|----------|----------------|
| 桁位置制約 | あり | なし（8-80桁のみ） |
| 可読性 | 低い | 高い |
| 記述量 | 多い | 少ない |
| 学習コスト | 高い | 低い |
| 既存資産 | 多い | 増加中 |
| 推奨度 | 保守のみ | 新規開発推奨 |

#### 移行戦略

1. **段階的移行**
   - 新規プログラムはフリーフォーム
   - 既存プログラムは必要時に移行
   - 混在プログラムも可能（/FREE.../ END-FREE）

2. **コンバージョンツール**
   - CVTRPGSRC コマンド（IBM提供）
   - RDi（Rational Developer for i）の変換機能

### 用語集

| 用語 | 説明 |
|------|------|
| ILE | Integrated Language Environment（統合言語環境） |
| RPG | Report Program Generator |
| DDS | Data Description Specifications（データ記述仕様） |
| SEU | Source Entry Utility（ソース入力ユーティリティ） |
| RDi | Rational Developer for i |
| CCSID | Coded Character Set Identifier |
| DBCS | Double Byte Character Set |

---

## 付録：実践的なコード例

### 完全なプログラム例

```rpg
     H*=====================================================================
     H* プログラム名: SAMPLE01
     H* 機能概要    : 社員マスタ照会
     H* 作成日      : 2024/01/15
     H*=====================================================================
     H DATEDIT(*YMD/) DATFMT(*ISO)
     H DFTACTGRP(*NO) ACTGRP(*NEW)
     H*
     F*=====================================================================
     F* ファイル定義
     F*=====================================================================
     FEMPMSTP   IF   E           K DISK    USROPN
     FEMPDSP    CF   E             WORKSTN
     F*
     D*=====================================================================
     D* データ構造・変数定義
     D*=====================================================================
     D WEMPNO          S              6S 0
     D WEMPNM          S             40A
     D WDEPT           S             20A
     D ERRFLG          S              1A
     D ERRMSG          S             50A
     D*
     C*=====================================================================
     C* メイン処理
     C*=====================================================================
     C                   EXSR      INIT
     C*
     C                   DOW       *IN03 = *OFF
     C*
     C                   EXFMT     SCREEN01
     C*
     C                   IF        *IN03 = *ON
     C                   LEAVE
     C                   ENDIF
     C*
     C                   EXSR      SEARCH
     C*
     C                   ENDDO
     C*
     C                   EXSR      TERM
     C*
     C                   EVAL      *INLR = *ON
     C                   RETURN
     C*
     C*=====================================================================
     C* サブルーチン: 初期処理
     C*=====================================================================
     C     INIT          BEGSR
     C*
     C                   OPEN      EMPMST
     C*
     C                   ENDSR
     C*
     C*=====================================================================
     C* サブルーチン: 検索処理
     C*=====================================================================
     C     SEARCH        BEGSR
     C*
     C     IEMPNO        CHAIN     EMPREC                         90
     C*
     C                   IF        *IN90 = *OFF
     C                   EVAL      OEMPNM = EMPNM
     C                   EVAL      ODEPT = DEPT
     C                   EVAL      ERRMSG = *BLANKS
     C                   ELSE
     C                   EVAL      OEMPNM = *BLANKS
     C                   EVAL      ODEPT = *BLANKS
     C                   EVAL      ERRMSG = 'データが見つかりません'
     C                   ENDIF
     C*
     C                   ENDSR
     C*
     C*=====================================================================
     C* サブルーチン: 終了処理
     C*=====================================================================
     C     TERM          BEGSR
     C*
     C                   CLOSE     EMPMST
     C*
     C                   ENDSR
```

---

**ドキュメント作成日**: 2024年11月
**バージョン**: 1.0
**対象**: IBM i 7.1以降のILE RPG

---

本資料は、ILE RPG固定長フォーマットの学習および開発業務の参考資料として作成されました。
詳細な仕様や最新情報については、IBM公式マニュアルを参照してください。
