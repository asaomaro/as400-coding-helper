# Quickstart ― RPG/CL Development Support Tool for VS Code

**Branch**: `001-rpg-cl-vscode-support`  
**Spec**: `specs/001-rpg-cl-vscode-support/spec.md`  
**Plan**: `specs/001-rpg-cl-vscode-support/plan.md`

このクイックスタートは、RPG/CL 開発支援拡張機能を VS Code で試すための最小限の手順を示します。

---

## 1. プロジェクト構成の想定

```text
vscode-extension/
├── src/
│   ├── extension/          # エントリーポイントとコマンド登録
│   ├── language/           # RPG/CL 固定長フォーマットの構文・ハイライト・編集支援
│   ├── prompter/           # F4 プロンプターのロジック・JSON 読み込み・WebView 連携
│   └── utils/              # 共通ユーティリティ
├── resources/
│   └── language/           # RPG/CL 用 TextMate 文法定義
└── test/
    ├── unit/               # ロジック単位のテスト
    └── integration/        # VS Code 拡張としての結合テスト
```

RPG/CL ソースを置くワークスペース側では、JSON ベースのプロンプター定義を `.rpg-cl/` 配下に配置することを想定します。

---

## 2. 必要な定義ファイルの準備

1. RPG/CL ソースを置くワークスペースのルートに `.rpg-cl/` ディレクトリを作成し、次の 2 つの JSON ファイルを用意します。  
   - `.rpg-cl/rpg-prompter.json`  : RPG 仕様書に相当する定義  
   - `.rpg-cl/cl-prompter.json`   : CL コマンド定義

2. 各 JSON ファイルには、少なくとも次の要素を含めます（詳細は spec の「JSON Definition Requirements」を参照）。  
   - キーワード名  
   - キーワードの説明（ヘルプ用）  
   - パラメータ一覧（パラメータ名、説明、入力タイプ、必須フラグ、デフォルト値、属性、桁数、プレースホルダー、最大パラメータ数、選択肢、ネストされたパラメータ、表示非表示フラグ／初期状態 など）

3. VS Code の設定 (`settings.json`) でパスをカスタマイズする場合は、拡張設定  
   - `rpgClSupport.jsonDefinitionPaths.rpgSpecPath`  
   - `rpgClSupport.jsonDefinitionPaths.clCommandsPath`  
   を使って上記 JSON のパスを指定します。指定しない場合、デフォルトで `.rpg-cl/rpg-prompter.json` / `.rpg-cl/cl-prompter.json` が使われます。

---

## 3. RPG/CL 編集体験の確認（User Story 1）

1. VS Code で `.rpgle`（固定長 RPG）または `.clp`（CL）のソースファイルを開きます。  
2. 拡張機能がファイル種別を自動判別し、固定長フォーマットに沿ったハイライトや列位置の扱いが行われることを確認します。  
3. 数行を編集して保存し、フォーマットやハイライトが崩れないことを確認します。  
4. CL ファイルで引用符（`'` または `"`）の数が奇数になるような行を作成し、該当行に警告診断が表示されることを確認します。  
5. RPG 固定形式ファイルで Ctrl+/ を押下し、列 7–8 のコメントマーカー（`**`）が行単位でトグルされることを確認します（FR-031 により 4 行目の先頭列など一部は保護されます）。

---

## 4. テンプレートからの新規作成（User Story 2）

このリリースではテンプレート生成機能はスコープ外のため、User Story 2 は実装されていません（今後の拡張候補として扱います）。

---

## 5. F4 プロンプターの動作確認（User Story 3）

1. RPG または CL ソース上で、プロンプターを利用したいキーワード／コマンド上にカーソルを置きます。  
2. F4 キーを押下し、プロンプターが WebView として起動し、該当キーワードに対応するパラメータが入力フィールドとして表示されることを確認します（対応する JSON 定義が存在する場合）。  
3. 必須パラメータにはラベル末尾に `*` が付与されていること、OK ボタンで値を確定し、キャンセル／Esc でプロンプターを閉じられることを確認します。  
4. CL ソースの場合、OK で確定した値に応じて論理的な 1 コマンド行（継続行を含む範囲）が置き換えられることを確認します。  
5. JSON 定義が見つからないキーワードに対して F4 を押した場合、「定義が見つからない」旨のメッセージが表示され、ソースは変更されないことを確認します。

---

## 6. バリデーションの確認（現行バージョン）

1. JSON 定義で `required: true` や `attributes.maxLength`、`attributes.numericOnly` などを設定したパラメータを用意し、F4 プロンプターを開きます。  
2. 初期表示時点で、明らかに不正なデフォルト値があればエラーとして表示されることを確認します（今後、入力中のリアルタイムバリデーションは拡張予定です）。  
3. 文字数や入力制約の詳細仕様については、実装状況と spec の記述を比較しながら必要に応じて調整してください。

---

## 7. IBM i / AS400 連携と今後の拡張

初期リリースでは、IBM i との直接連携（ソース送信やコンパイル実行）は行わず、VS Code 上でのローカル編集体験と JSON ベースの F4 プロンプターにフォーカスします。  
将来的に連携機能を追加する場合は、Constitution の Principle 1 に沿って、ターゲット環境・必要権限・ロールバック手順を `plan.md` / `tasks.md` に明示した上で設計・実装を行ってください。

